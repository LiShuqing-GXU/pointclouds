function [D,nni] = densityfilter(S,k,tol,varargin)
    X            = points(S);
    if  nargin == 5
        nni     = varargin{1};
        nni     = varargin{1};
    else
        [nni,d] = knnsearch(X.',X.','K',k);
    end
    select       = mean(d,2) < tol;
    D            = subset(S,select);
end